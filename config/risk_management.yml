# =============================================================================
# 风险管理配置
# 定义多层级风险控制规则和限额
# =============================================================================

# 全局风险参数
global_risk:
  # 风险控制开关
  enabled: true
  
  # 风险评估频率(秒)
  evaluation_interval: 30
  
  # 紧急熔断开关
  emergency_stop:
    enabled: true
    manual_override: false    # 手动覆盖紧急停止

# 资金管理
capital_management:
  # 总资金限制
  total_capital_limit: 100000.0
  
  # 可用资金比例
  available_capital_ratio: 0.95
  
  # 保证金要求
  margin_requirements:
    initial_margin: 0.1       # 初始保证金比例
    maintenance_margin: 0.05  # 维持保证金比例
    
  # 杠杆控制
  leverage:
    max_leverage: 1.0         # 最大杠杆倍数
    leverage_warning: 0.8     # 杠杆预警阈值

# 仓位风险控制
position_risk:
  # 单一资产限制
  single_asset:
    max_position_ratio: 0.3   # 单一资产最大仓位比例
    position_warning: 0.25    # 仓位预警阈值
    
  # 行业/类别集中度
  sector_concentration:
    max_sector_exposure: 0.6  # 最大行业暴露
    crypto_max_exposure: 0.8  # 加密货币最大暴露
    
  # 相关性风险
  correlation_risk:
    max_correlation: 0.7      # 最大相关性
    correlation_window: 30    # 相关性计算窗口(天)

# 市场风险控制
market_risk:
  # 波动率控制
  volatility_control:
    target_volatility: 0.15   # 目标波动率(年化)
    max_volatility: 0.25      # 最大波动率
    volatility_window: 20     # 波动率计算窗口(天)
    
  # VaR限制
  var_limits:
    daily_var_limit: 0.02     # 日VaR限制(2%)
    var_confidence: 0.95      # VaR置信度
    var_window: 252           # VaR计算窗口(天)
    
  # 最大回撤控制
  drawdown_control:
    max_drawdown: 0.15        # 最大回撤限制
    drawdown_warning: 0.10    # 回撤预警阈值
    recovery_threshold: 0.05  # 恢复阈值

# 交易风险控制
trading_risk:
  # 单笔交易限制
  single_trade:
    max_trade_size: 0.05      # 单笔交易最大规模(占总资金比例)
    min_trade_size: 0.001     # 单笔交易最小规模
    
  # 交易频率控制
  frequency_control:
    max_trades_per_day: 50    # 每日最大交易次数
    max_trades_per_hour: 10   # 每小时最大交易次数
    cooling_period: 60        # 交易冷却期(秒)
    
  # 价格保护
  price_protection:
    max_slippage: 0.005       # 最大滑点(0.5%)
    price_band_width: 0.02    # 价格保护带宽度(2%)
    
  # 订单风险
  order_risk:
    max_order_value: 10000.0  # 单个订单最大价值
    order_timeout: 300        # 订单超时时间(秒)

# 流动性风险
liquidity_risk:
  # 最小流动性要求
  min_liquidity:
    min_daily_volume: 1000000 # 最小日成交量(USDT)
    min_depth: 50000          # 最小市场深度
    
  # 流动性评估
  liquidity_assessment:
    bid_ask_spread_max: 0.01  # 最大买卖价差
    market_impact_max: 0.005  # 最大市场冲击

# 时间风险控制
time_risk:
  # 交易时间窗口
  trading_hours:
    enabled: false            # 是否启用交易时间限制
    allowed_hours: [0, 23]    # 允许交易的小时范围
    timezone: "UTC"
    
  # 节假日控制
  holiday_control:
    enabled: false
    no_trading_days: []       # 禁止交易的日期列表

# 技术风险控制
technical_risk:
  # 系统延迟控制
  latency_control:
    max_execution_latency: 1000  # 最大执行延迟(毫秒)
    latency_warning: 500         # 延迟预警阈值
    
  # 数据质量控制
  data_quality:
    max_data_age: 300         # 最大数据延迟(秒)
    min_data_quality: 0.95    # 最小数据质量分数
    
  # 连接风险
  connectivity:
    max_disconnection_time: 60  # 最大断线时间(秒)
    backup_enabled: false       # 是否启用备用连接

# 风险事件处理
risk_events:
  # 风险级别定义
  risk_levels:
    low:
      threshold: 0.7
      actions: ["log", "monitor"]
    medium:
      threshold: 0.8
      actions: ["log", "alert", "reduce_position"]
    high:
      threshold: 0.9
      actions: ["log", "alert", "stop_trading"]
    critical:
      threshold: 0.95
      actions: ["log", "alert", "emergency_stop", "notify_admin"]
      
  # 自动处理规则
  auto_actions:
    position_reduction:
      enabled: true
      reduction_ratio: 0.5    # 减仓比例
      
    trading_halt:
      enabled: true
      halt_duration: 300      # 暂停交易时间(秒)
      
    emergency_liquidation:
      enabled: false          # 紧急平仓
      liquidation_method: "market"

# 合规风险控制
compliance:
  # 监管要求
  regulatory:
    max_leverage_regulatory: 1.0  # 监管最大杠杆
    position_reporting: true      # 仓位报告要求
    
  # 内部合规
  internal_compliance:
    trade_approval: false         # 交易审批要求
    daily_pnl_limit: 5000.0      # 日盈亏限制
    monthly_pnl_limit: 20000.0    # 月盈亏限制

# 压力测试配置
stress_testing:
  # 压力测试场景
  scenarios:
    market_crash:
      price_drop: -0.3        # 市场下跌30%
      volatility_spike: 3.0   # 波动率放大3倍
      
    liquidity_crisis:
      volume_reduction: 0.5   # 成交量减少50%
      spread_widening: 5.0    # 价差扩大5倍
      
  # 测试频率
  test_frequency: "weekly"    # daily|weekly|monthly

# 日志和监控
logging:
  level: "INFO"
  
  # InfluxDB 指标字段
  metrics_fields:
    - "risk_score_overall"
    - "portfolio_var_daily"
    - "position_concentration"
    - "leverage_current"
    - "drawdown_current"
    - "volatility_realized"
    - "correlation_max"
    - "liquidity_score"
    - "risk_events_count"
    - "trades_blocked"
    - "emergency_stops"
