# 功能完成度与已知限制

> 最后更新: 2026-02-01

本文档清晰记录 AlgorithmTrader 各模块的完成状态、已知限制及使用注意事项。

## 功能完成度矩阵

| 模块 | 功能 | 状态 | 说明 |
|------|------|------|------|
| **数据采集** | OKX 现货行情 | ✅ 可用 | 公共 API，无需 Key |
| | OKX 永续行情 | ✅ 可用 | 公共 API，无需 Key |
| | Parquet 存储 | ✅ 可用 | 历史数据读写 |
| | InfluxDB 存储 | ✅ 可用 | 实时数据/监控 |
| | 数据质量检测 | ✅ 可用 | 缺失/异常检测 |
| **策略框架** | 策略基类 | ✅ 可用 | StrategyBase |
| | 策略注册表 | ✅ 可用 | 自动发现策略 |
| | 示例策略 | ✅ 可用 | 5 种内置策略 |
| **回测** | 单策略回测 | ✅ 可用 | BacktestEngine |
| | 批量回测 | ✅ 可用 | BacktestRunner (已修复) |
| | 回测报告 | ✅ 可用 | JSON/Parquet 输出 |
| | HTML 报告 | 🚧 部分 | 基础可用，图表待优化 |
| **优化** | 参数扫描 | ✅ 可用 | GridSearch |
| | 随机搜索 | ✅ 可用 | RandomSearch |
| | 拉丁超立方 | ✅ 可用 | LHS 采样 |
| | Walk-Forward | 🚧 部分 | 框架就绪，待完善 |
| **执行** | OKX 现货下单 | ✅ 可用 | 需 API Key |
| | OKX 永续下单 | ✅ 可用 | 需 API Key |
| | 订单管理器 | ✅ 可用 | 订单追踪 |
| | 滑点/手续费模型 | ✅ 可用 | 可配置 |
| **风控** | 仓位限制 | ✅ 可用 | 风控规则 |
| | 止损规则 | ✅ 可用 | 多种止损 |
| | 风控引擎 | ✅ 可用 | 规则组合 |
| **通知** | Telegram | ✅ 可用 | Bot 通知 |
| | Webhook | ✅ 可用 | 自定义 URL |
| **特征工程** | 特征引擎 | ✅ 可用 | 内置 15+ 因子 |
| | 因子库 | 🚧 部分 | 基础因子 |
| | A 股因子 | ✅ 可用 | 动量/波动率/换手率/市值/复权价 |
| **A 股全链路** | Tushare 数据下载 | ✅ 可用 | 全市场日线 OHLCV + 基本面 |
| | 数据存储 | ✅ 可用 | ParquetStore + AShareFundamentalsStore |
| | 回测规则 | ✅ 可用 | T+1/涨跌停/100 股/板块识别 |
| | 费用模型 | ✅ 可用 | 佣金(万三) + 印花税 + 过户费 |
| | 引擎集成 | ✅ 可用 | A 股规则验证 → 撮合 → 记录 |
| | A 股因子 | ✅ 可用 | 16 个因子，5 组分类 |
| | Web UI 数据 Tab | ✅ 可用 | 下载按钮/进度/统计 |
| | 报告成本分解 | ✅ 可用 | 佣金/印花税/过户费拆分 |
| | 增量更新 | ❌ 未实现 | 计划中 |
| | 分钟线数据 | ❌ 未实现 | 计划中 |
| | 实盘接入 | ❌ 未实现 | 计划中 |
| **Web 界面** | 策略列表 | ✅ 可用 | 展示所有策略 |
| | 服务状态 | ✅ 可用 | 真实健康检查 |
| | 回测历史 | ✅ 可用 | 加载历史记录 |
| | 创建回测 | 🚧 部分 | 接口就绪 |
| | 优化任务 | 🚧 部分 | 接口就绪 |
| **基础设施** | Docker Compose | ✅ 可用 | 一键部署 |
| | Grafana 面板 | 🚧 部分 | 基础预置 |
| | 日志聚合 | ✅ 可用 | Loki + Promtail |
| | 健康检查 | ✅ 可用 | 各服务健康检查 |

### 状态说明
- ✅ 可用：功能已完成，可以直接使用
- 🚧 部分：框架完成，功能不完整或需进一步测试
- ❌ 未实现：计划中但尚未开发

## 已知限制

### 1. 回测模块
- 回测使用**下一根 Bar 的开盘价**成交，不支持订单簿级别撮合
- 适用于 15 分钟及以上周期，高频策略需谨慎评估滑点影响
- 多品种回测时，各品种独立处理，不支持跨品种套利的精确时序

### 2. 优化模块
- 并行优化在 Windows 上可能存在兼容性问题
- 大规模参数空间（>10000 组合）建议分批执行
- Walk-Forward 验证器的样本内外分割仅支持时间维度

### 3. 数据存储
- `src/data/store/` 目录下的文件为**兼容性导入**，实际实现在 `src/data/storage/`
- Parquet 分区按年月划分，跨年查询需手动合并
- InfluxDB 写入需确保时序单调递增，否则可能覆盖数据

### 4. Web 界面
- 当前版本侧重展示，**实时数据刷新间隔为 30 秒**
- 优化任务创建后在后台执行，需手动刷新查看进度
- 无身份验证，仅建议内网使用

### 5. 实盘交易
- Trader 服务需要有效的交易所 API Key
- 风控规则需根据实际账户资金配置
- 订单执行异常时的自动重试机制尚未完善

### 6. A 股全链路
- **已完成**: 数据下载(日线OHLCV+基本面)、ParquetStore存储、回测规则(T+1/涨跌停/100股/印花税)、AShareFeeModel费用模型、引擎集成、A股因子(16因子5组)、Web UI A股数据Tab、报告成本分解
- **未做**: 增量更新（当前仅支持一次性回填）、分钟线数据、A股实盘接入
- 需要 Tushare 5000 积分 Token 才能正常使用全市场数据下载
- 涨跌停判断依赖昨收价，首次上市股票无昨收价时跳过限制检查
- 复权价格因子需要先下载 adj_factor 数据
- ST 股票识别依赖 daily_basic 中 `is_st` 字段，若缺失则默认不是 ST

## 依赖关系

### 必需依赖
```
Python >= 3.11
pandas >= 2.0
numpy >= 1.24
ccxt >= 4.0
```

### 可选依赖（按功能）
| 功能 | 依赖 |
|------|------|
| InfluxDB 存储 | influxdb-client |
| Telegram 通知 | python-telegram-bot |
| Web 界面 | nicegui |
| 研究环境 | jupyter, matplotlib |
| IBKR 接口 | ib_insync |

## 快速验证

运行烟雾测试脚本验证核心功能：

```bash
python scripts/smoke_test.py
```

该脚本会自动：
1. 生成模拟测试数据
2. 导入策略模块
3. 运行一次回测
4. 计算绩效指标
5. 生成报告
6. 测试特征引擎

所有测试通过表示核心模块可用。

## 下一步计划

优先级从高到低：

1. **完善 Walk-Forward 验证** - 支持滚动窗口优化
2. **Web 界面实用化** - 添加实时刷新和任务状态
3. **Grafana 预置面板** - 回测结果和实盘监控
4. **测试覆盖率** - 为核心模块添加单元测试
5. **文档完善** - API 参考和使用案例

## 常见问题

### Q: 回测结果与实盘差异大？
A: 请确认：
- 滑点设置是否合理（默认 0.05%）
- 手续费率是否与实际一致
- 数据时间框架是否匹配策略设计

### Q: 优化结果过拟合？
A: 建议：
- 使用 Walk-Forward 验证
- 减少参数维度
- 增加样本外测试时长

### Q: Web 界面显示"服务未知"？
A: 检查：
- Docker 是否安装且运行
- 服务容器是否启动
- 网络连接是否正常

---

如有其他问题，请查阅 [FAQ](guides/faq.md) 或提交 Issue。
