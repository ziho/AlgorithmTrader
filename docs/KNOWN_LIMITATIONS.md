# 功能完成度与已知限制

> 最后更新: 2026-02-13

本文档记录 AlgorithmTrader 各模块的完成状态、已知限制及使用注意事项。

## 功能完成度矩阵

| 模块 | 功能 | 状态 | 说明 |
|------|------|------|------|
| **数据采集** | OKX 现货/永续行情 | ✅ 可用 | 公共 API 无需 Key |
| | Binance 行情 | ✅ 可用 | REST + Public Data |
| | Parquet 存储 | ✅ 可用 | 历史数据读写 |
| | InfluxDB 存储 | ✅ 可用 | 实时数据/监控 |
| | 数据质量检测 | ✅ 可用 | 缺失/异常检测 |
| **策略框架** | 策略基类 | ✅ 可用 | StrategyBase |
| | 策略注册表 | ✅ 可用 | register_strategy |
| | 示例策略 | ✅ 可用 | 5 种内置策略 |
| **回测** | 单策略回测 | ✅ 可用 | BacktestEngine |
| | 批量回测 | ✅ 可用 | BacktestRunner |
| | 回测报告 | ✅ 可用 | JSON/Parquet 输出 |
| | HTML/MD 报告 | 🚧 部分 | demo_backtest.py 生成 |
| **优化** | 参数扫描 | ✅ 可用 | Grid/Random/LHS |
| | Walk-Forward | ✅ 可用 | 基础版验证器 |
| **执行** | OKX 现货下单 | ✅ 可用 | 需 API Key |
| | OKX 永续下单 | ✅ 可用 | 需 API Key |
| | 订单管理器 | ✅ 可用 | 订单追踪 |
| | 滑点/手续费模型 | ✅ 可用 | 可配置 |
| **风控** | 风控规则 | ✅ 可用 | 最大回撤/仓位等 |
| | 风控引擎 | ✅ 可用 | 规则链执行 |
| **通知** | Telegram | ✅ 可用 | 多 Bot 支持 |
| | Bark | ✅ 可用 | 多设备支持 |
| | Webhook | ✅ 可用 | 通用接口 |
| | SMTP 邮件 | ✅ 可用 | 基础实现 |
| **特征工程** | 特征引擎 | ✅ 可用 | 13 个内置特征 |
| | A 股因子 | ✅ 可用 | 14 个因子，5 组分类 |
| **A 股全链路** | Tushare 数据下载 | ✅ 可用 | 日线 OHLCV + daily_basic + adj_factor |
| | 数据存储 | ✅ 可用 | ParquetStore + AShareFundamentalsStore |
| | 回测规则 | ✅ 可用 | T+1/涨跌停/最小手数 |
| | 费用模型 | ✅ 可用 | 佣金 + 印花税 + 过户费 |
| | 引擎集成 | ✅ 可用 | 规则验证 → 撮合 → 记录 |
| | Web UI 数据 Tab | ✅ 可用 | 下载/筛选/统计 |
| | 报告成本分解 | ✅ 可用 | 佣金/印花税/过户费拆分 |
| | 增量更新 | ✅ 可用 | 断点续传 |
| | 分钟线数据 | ❌ 未实现 | 计划中 |
| | 实盘接入 | ❌ 未实现 | 计划中 |
| **Web 界面** | 策略列表 | ✅ 可用 | 参数配置/启用 |
| | 服务状态 | ✅ 可用 | 健康检查 |
| | 回测历史 | ✅ 可用 | 记录管理 |
| | 创建回测 | 🚧 部分 | 表单已就绪 |
| | 优化任务 | 🚧 部分 | 表单已就绪 |
| **基础设施** | Docker Compose | ✅ 可用 | 一键部署 |
| | Grafana 面板 | 🚧 部分 | 基础预置 |
| | 日志聚合 | ✅ 可用 | Loki + Promtail |
| | 健康检查 | ✅ 可用 | 多服务检测 |

### 状态说明

- ✅ 可用：功能已完成，可以直接使用
- 🚧 部分：框架完成，功能不完整或需进一步测试
- ❌ 未实现：计划中但尚未开发

## 已知限制

### 1. 回测模块

- 回测使用**下一根 Bar 的开盘价**成交，不支持订单簿级别撮合
- 适用于 15 分钟及以上周期，高频策略需谨慎评估滑点影响
- 多品种回测时间戳取并集，跨品种套利的精细时序需自行评估

### 2. 优化模块

- 大规模参数空间建议分批执行
- Walk-Forward 基于时间序列切分，未考虑跨市场同步偏差

### 3. 数据存储

- `src/data/store/` 为兼容性导入，实际实现位于 `src/data/storage/`
- 相同时间戳 + tag 在 InfluxDB 中会被最新写入覆盖

### 4. Web 界面

- 以管理与展示为主，部分任务创建功能仍在完善
- 无身份验证，仅建议内网使用

### 5. 实盘交易

- Trader 服务需要有效的交易所 API Key
- 风控规则需根据实际账户资金配置
- 异常恢复与重试策略仍需进一步强化

### 6. A 股全链路

- 需要 Tushare Token（高频下载建议较高积分）
- 涨跌停判断依赖昨收价，首次上市股票可能跳过限制检查
- 复权价格因子需要先下载 adj_factor 数据
- ST 股票识别依赖 daily_basic 的 `is_st` 字段

## 依赖关系

### 必需依赖

```
Python >= 3.11
pandas >= 2.0
numpy >= 1.24
ccxt >= 4.0
```

### 可选依赖（按功能）

| 功能 | 依赖 |
|------|------|
| InfluxDB 存储 | influxdb-client |
| Telegram 通知 | python-telegram-bot |
| Web 界面 | nicegui |
| A 股数据 | tushare |
| IBKR 接口 | ib_insync |

## 快速验证

运行烟雾测试脚本验证核心功能：

```bash
python scripts/smoke_test.py
```

该脚本会：
1. 生成模拟测试数据
2. 导入策略模块
3. 运行一次回测
4. 计算绩效指标
5. 生成报告
6. 测试特征引擎

## 下一步计划

优先级从高到低：

1. **完善 Walk-Forward 验证** - 支持滚动窗口优化
2. **Web 界面实用化** - 添加实时刷新和任务状态
3. **Grafana 预置面板** - 回测结果和实盘监控
4. **测试覆盖率** - 为核心模块添加单元测试
5. **文档完善** - API 参考和使用案例

---

如有其他问题，请查阅 [FAQ](guides/faq.md) 或提交 Issue。
